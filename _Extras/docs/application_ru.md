Класс WHM_Core_Application. Реестр. Проброс данных в DataWriter
===============================================================
Основная задача класса `WHM_Core_Application` это расширенный функционал по хранению различных данных различных частей приложения, т.е. реестр (registry). В общих чертах базовый функционал очень похож на методы `XenForo_Application::get` и `XenForo_Application::set`, но с дополнительным функциналом и опциями.

Класс `WHM_Core_Application` инстанцируется обычно самым первым в событии `init_dependencies` и запускает другое событие `init_application` c сигнатурой:
`public static function initApplication(WHM_Core_Application $app)`

Методы класса
-------------
Все методы в основном рассчитаны на работу с массивами, т.е. нужны для того чтобы в нескольких местах запомнить значения, а в одном получить объединенное значение.

### Сеттер
`public function set($key, $type, array $data)`
`$key` и `$type` строковые ключи по которым сохранять данные. Последовательный вызов метода с одинаковыми ключами будет добавлять новые данные к предыдущим. В качестве `$type` можно использовать имя датарайтер класса.

### Геттер
`public function get($key, $type, $remove = false)`
`$key` и `$type` ключи по которым надо извлечь данные, `$key` строковой как и в сеттере, а `$type` может быть как строковой, так и массив ключей (данные будут последовательно объединены для каждого из этих ключей), так и объект (будет попытка извлечь данные для этого объекта если в реестр при записи в качестве ключа использовалось имя класса).


Типичные проблемы расширении стандартного функционала XenForo
-------------------------------------------------------------
Часто встречающаяся проблема, когда при расширении стандартного функционала XenForo (узлы, темы, сообщения) расширять приходится различные классы (контроллеры, модели, датарайтеры) у которых нет прямой связи для дочерних классов. Т.е. приходится в контроллере в action-е сначала независимо получать входные данные, писать их с каким-то ключем в реестр XenForo через `XenForo_Application::set` (или через какой-то статическую переменную класса), потом в датарайтере перед записью читать эти данные. Такой метод хорошо работает, только за исключением того что во первых захламляется XenForo реестр неинформативными ключами, во вторых любой хак может сделать неработоспособным любой другой хак и искать ошибки в таких случаях очень проблематично.

Поэтому реально помогает в таких случаях использование реестра с автоматической возможностью объединения массивов данных, а также с возможностью извлекать данные исходя из имени класса.

Проброс данных в DataWriter
---------------------------
Т.к. проброс данных из дочернего контроллера в датарайтер запускаемый в родительском контролле довольно часто встречаемая задача, то для этого был расширен базовый датарайтер.

Пример использования в контроллере:

~~~php
<?php
			$app = WHM_Core_Application::getInstance();
			//получаем поля из входных данных
			$input = $this->_input->filter(
				array(
            	    'some_array_field' => XenForo_Input::ARRAY_SIMPLE,
            	    'some_uint_field'  => XenForo_Input::UINT
            	)
			);

			$app->set(
				//предопределенный ключа для данных датарайтера
				WHM_Core_Application::DW_DATA,
				//Для какого датарайтера передаются данные
				'XenForo_DataWriter_Thread',
				//входные данные
				$input
			);
~~~
**Внимание!** Если какие-то из полей передаваемых данных, не существуют в полях датарайтера, то они все сохранится в `extraData` датарайтера с ключем `WHM_Core_Application::DW_EXTRA`. Установка данных внутри датарайтера проиcходит на стадии preSave (см. `WHM_Core_DataWriter_Abstract::preSave`), поэтому в дочерних методах датарайтера для получения валидированных данных в presave, надо сначало запускать родительский presave.